<HEAD>
  <SCRIPT SRC="../ganja.js"></SCRIPT>
</HEAD>
<BODY><SCRIPT>
// Create a Clifford Algebra with 3,0,1 metric. 
Algebra(3,0,1).inline(()=>{ 

  // Specify a point directly (trivectors specified with overloaded e-notation.)
  var point = (x,y,z)=>1e123-x*1e012-y*1e013+z*1e023;
  var rotor = (P,a)=>Math.cos(a/2)+Math.sin(a/2)*P;
  
  // Load a wavefront 3D OBJ file.
  var obj = (url,complete)=>{
    var req = new XMLHttpRequest(); req.onload=e=>{
      var t = req.response.split('\n'), v=t.filter(x=>x[0]=='v'), f=t.filter(x=>x[0]=='f').map(x=>x.split(/\s+/).slice(1,4)), p;
      complete(p=v.map(x=>point.apply(this,x.split(/\s+/).slice(1).map(x=>13*parseFloat(x)))),                                                // points
               [].concat.apply([],f.map(x=>x.map((y,yi)=>(y>x[(yi+1)%3])?undefined:[y,x[(yi+1)%3]]))).filter(x=>x).map(x=>x.map(x=>p[x-1])),  // edges
               f.map(x=>x.map(x=>p[x-1])));                                                                                                   // faces
    }; req.open("GET",url,false); req.send();
  }
  
  // Our camera position and orientation
  var  time=0,camera=1 - 1e02 +1e13-1.2e03+0.9e01, cut=-0.57*1.3e0+1e2;
    
  // Read obj
  obj("bunny.obj",(points,edges,faces)=>{
      // Graph the bunny as backdrop
      document.body.appendChild(this.graph(edges,{camera}));
      
      // Now graph (animated) the cut .. 
      Object.assign(document.body.appendChild(this.graph(()=>{
        var time=performance.now()/15000;    
        cut.set( (1.43+ Math.sin(time*3))*1e0+1e2);
        return  [].concat(edges.map((x,xi)=>{ 
             var l=x[0]&x[1], c = (l^cut), l2=x[0]&c.Normalized; 
             var h = ((c.e123>0)?1:-1)*(l2<<l).s / (l<<l).s;
             return (c.e123 && h>0 && h<1) ? c:0xff8888;
        }));
      },{animate:true,camera})).style,{backgroundColor:'transparent',position:'fixed',left:0,right:0,width:'100%',height:'100%'});
  });
})();
</SCRIPT></BODY>