<HEAD>
  <SCRIPT SRC="../ganja.js"></SCRIPT>
</HEAD>
<BODY><SCRIPT>
// Create a Clifford Algebra with 3,0,1 metric. 
Algebra(3,0,1).inline(()=>{ 
    
  // Helpers
  var range=(start,stop,step)=>{ var ret=[]; for (var i=start; i<stop; i+=(step||1)) ret.push(i); return ret; }
    
  // Specify a point directly (trivectors specified with overloaded e-notation.)
  var point = (x,y,z)=>1e123-x*1e012+y*1e013+z*1e023;

  // Our camera position and orientation
  var camera=0e0; 
  
  // Allocate outside of animation .. a bunch of points 
  var step = 0.2;
  var points_fx = [].concat.apply([], range(-1,1,step).map(x=>range(-1,1,step).map(y=>point(x,0,y))))
  var points_dx = [].concat.apply([], range(-1,1,step).map(x=>range(-1,1,step).map(y=>point(x,0,y))))
  var points_dy = [].concat.apply([], range(-1,1,step).map(x=>range(-1,1,step).map(y=>point(x,0,y))))

  // points are stored by ref, so we pre-create our render array.
  var render = [].concat( 0x444444,"f(x,y)=t*(x^3)/2 - 5t*(y^2)/2 + 1",0xCC4444,"f(x,y)/dx",0x4444CC,"f(x,y)/dy", 0x444444,points_fx,0xFFCCCC,points_dx,0xCCCCFF,points_dy );

  // The function we are graphing. (0.5*x^3 - 0.5*y^2 + 1)
  var f = (x,y,time)=>0.5*Math.sin(time)*x*x*x-0.5*Math.cos(time*5)*y**2+1;
  
  // Graph the 3D items
  document.body.appendChild(this.graph(()=>{
    // An external time parameter, and our camera rotation.
    var time=performance.now()/4000;    
    camera.set(Math.cos(time)+Math.sin(time)*1e13);

    // Evaluate over the field and update our points.
    for (var i=0,x=-1; x<1; x+=step) for (var y=-1; y<1; y+=step) {
       var r = f(x + 1e01, y + 1e02, time);
       points_fx[i].e013 = r.s;      // overwrite y coordinate.
       points_dx[i].e013 = r.e01;
       points_dy[i].e013 = r.e02;
    }     
    return render;
  },{animate:true,camera})); 
  
})();
</SCRIPT></BODY>