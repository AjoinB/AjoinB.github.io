<HEAD>
  <SCRIPT SRC="../ganja.js"></SCRIPT>
</HEAD>
<BODY><SCRIPT>
// Create a Clifford Algebra with 2,0,1 metric.
Algebra(2,0,1).inline(()=>{

  // in 2D the seperating axis test involves testing the extent of the projection
  // onto one of four possible seperating axi. 

  // Some identities we'll use.
  var point      = (x,y)=>1e12-x*1e02+y*1e01,
      join       = (X,Y)=>!(!X^!Y),
      dist_pl    = (P,l)=>(P.Normalized^l.Normalized).e012,
      rotor      = (point,angle)=>Math.cos(angle/2) + Math.sin(angle/2)*point.Normalized,
      box        = (p,d)=>[point(-p.e02-d,p.e01-d),point(-p.e02+d,p.e01-d),point(-p.e02+d,p.e01+d),point(-p.e02-d,p.e01+d)];
  
  // One box can be moved .. its around this point.
  var pb = point(-0.8,-1);
  
  // Seperating axis test.
  var sat=(a,b)=>{ 
    var A1=join(a[0],a[1]), A2=join(a[1],a[2]), B1=join(b[0],b[1]), B2=join(b[1],b[2]);
    var check=(box,axis,ref)=>{
        var refd=dist_pl(ref,axis), dists=box.map(x=>dist_pl(x,axis));
        var min=Math.min.apply(Math,dists), max=Math.max.apply(Math,dists);
        return ((refd<min)||(refd>max))&&((0<min)||(0>max));
    }
    return check(b,A2,a[0])||check(b,A1,a[2])||check(a,B2,b[0])||check(a,B1,b[2]);
  }
  
  // Graph it
  document.body.appendChild(this.graph([()=>{
    // Define two boxes.
    var pa = point(0,0.3-(performance.now()*0.0001%2));
    var a = box(pa,0.45).map(x=>rotor(pa,performance.now()*0.001)>>>x), b=box(pb,0.4);
    return [a,sat(a,b)?0xccffcc:0xffaaaa,b,0x444444,pb,"move",this.graph]}]));
})();
</SCRIPT></BODY>