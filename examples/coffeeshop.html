<HEAD>
  <STYLE>
    body    { margin: 0; background-color:#EEE; position:relative; display:flex; flex-direction:column; font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }
    #SAMPLE { width: 512px; height: 100%; position: absolute; top: 0px; left: 0px; border: 0; }
    #SOURCE { position:absolute; bottom:0px; top:0px; left:512px; right:0px; margin:0 }
    #HEADER { position:relative; display:flex; flex-flow:wrap; z-index:10 }
    #MAIN   { border-top:1px solid black; position : relative; flex-grow:1 } 
    .TAB    { cursor:pointer; background-color:#ccc; color:#666; margin-bottom:-1px;  border:1px solid black; border-bottom:1px solid black; border-top-left-radius:10px; border-top-right-radius:10px; text-decoration:none; padding:5px; padding-left:15px; padding-right:15px; margin-right:-1px; }
    .SELECTED { background-color:#eee; color:#606060; border-bottom:1px solid #eee;}
    H3      { padding-left : 25px }
    .legend { position:fixed; top:12px; right:5px;  }
    .legend > span { padding:4px; border:1px solid #AAA; margin:4px; border-radius:5px; }
    .pga2d          { background-color:#ccf; color:#668; }
    .pga2d.SELECTED { background-color:#eef; color:#606080; }
    .quaternion          { background-color:#cfc; color:#686; }
    .quaternion.SELECTED { background-color:#efe; color:#608060; }
    #RUN { box-sizing:border-box; position:absolute; top:10px; transition:opacity 0.3s linear; opacity:0; left:10px; z-index:100; padding:5px;  background-color:#ffc; color:#886; border:1px solid #886; border-radius:5px; cursor:pointer; }
    #RUN:hover { border : 2px solid #886; top:9px; left:9px}
  </STYLE>
  <SCRIPT SRC="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/ace.js"></SCRIPT>
  <SCRIPT SRC="../ganja.js"></SCRIPT>
</HEAD>
<BODY>
  <H3>The Coffeeshop<BR>
  <SMALL>free <A HREF="https://github.com/enkimute/ganja.js" TARGET="_blank">ganja</A> samples!</SMALL>
  </H3>
  <DIV CLASS="legend">
    <SPAN CLASS="">Complex</SPAN>
    <SPAN CLASS="quaternion">Quaternion</SPAN>
    <SPAN CLASS="pga2d">PGA 2D</SPAN>
  </DIV>
  <DIV ID="HEADER">
  </DIV>
  <DIV ID="MAIN">
    <DIV ID="RUN">&#x25B6; Run Changes <SPAN STYLE="opacity:0.5; float:right; margin-left:30px">Ctrl+Enter</SPAN></DIV>
    <IFRAME ID="SAMPLE" BORDER=0 SRC=""></IFRAME>
    <PRE ID="SOURCE"></PRE>
  </DIV>
  <SCRIPT>
    var examples_pga = ["complex_mandelbrot","quaternion_hue","quaternion_mandelbrot","pga2d_points_and_lines","pga2d_distances_and_angles","pga2d_project_and_reject","pga2d_rotors_and_translators","pga2d_isometries", "pga2d_inverse_kinematics","pga2d_pose_estimation","pga2d_desargues_theorem"]
    
    var $ = document.getElementById.bind(document);
    
    if (document.location.hash=='') document.location.hash = 'pga2d_points_and_lines';
    
    examples_pga.forEach((e,i)=>$('HEADER').innerHTML+=
      `<A CLASS="TAB ${e.split('_')[0]} ${document.location.hash.slice(1)==examples_pga[i]?' SELECTED':''}" 
          ONCLICK="[].map.call(document.querySelectorAll('.SELECTED'),a=>a.classList.remove('SELECTED')); 
                   this.classList.add('SELECTED'); document.location.hash='${e}';
                   loaded=false; $('SAMPLE').src='${'example_'+e+'.html'}';"
          >${e.split('_').slice(1).join(' ')}</A>`);
    
    var editor = ace.edit('SOURCE');
    editor.setTheme("ace/theme/chrome");
    editor.session.setMode("ace/mode/javascript");
    editor.session.setUseWorker(false);
    editor.setHighlightActiveLine(false);
    editor.$blockScrolling = Infinity;
    
    var loaded=false;
    $('SAMPLE').src = 'example_'+(document.location.hash.slice(1).replace(/ /g,'_')||examples_pga[0])+'.html';    
    $('SAMPLE').onload = function(){ 
      var $$ = $('SAMPLE').contentDocument.querySelectorAll.bind($('SAMPLE').contentDocument);
      
      $('SAMPLE').contentDocument.body.style.margin=0;
      $('SAMPLE').contentDocument.body.style.overflow='hidden';
      
      editor.setValue($('SAMPLE').contentDocument.querySelectorAll('script')[1].innerText.split('\n').slice(1).reverse().slice(1).reverse().join('\n'));
      editor.clearSelection();
      loaded=true;

      var changed=false;
      editor.session.on('change',e=>{ changed=loaded&&true;  if (changed) $('RUN').style.opacity=1; });


editor.commands.addCommand({
    name: "run changes",
    bindKey: {win: "Ctrl-Enter", mac: "Command-Option-Enter"},
    exec: function(editor) { $('RUN').click(); }
});



      $('RUN').onclick = function(e) { e.preventDefault(); e.stopPropagation(); if (!changed || !loaded) return; changed=false; $('RUN').style.opacity=0;
        $('SAMPLE').contentDocument.body.innerHTML='';
        try { $('SAMPLE').contentWindow.eval( editor.getValue() ); }
        catch (e) { $('SAMPLE').contentDocument.body.innerHTML='<PRE>'+e.message+'</PRE>';}
        editor.focus();
      };

      
    };
  </SCRIPT>
</BODY>